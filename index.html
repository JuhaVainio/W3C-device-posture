<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <title>
      The Screen Fold Angle API
    </title>
    <script src='https://www.w3.org/Tools/respec/respec-w3c' async class=
    'remove'></script>
    <script class='remove'>
      var respecConfig = {
        specStatus: "ED",
        shortName: "screen-fold-angle",
        editors: [{
          name: "Diego González",
          url: "https://twitter.com/diekus",
          company: "Samsung",
          companyURL: "https://developer.samsung.com/internet",
          w3cid: "#####"
        },
        {
          name: "Kenneth Rohde Christiansen",
          company: "Intel Corporation",
          companyURL: "https://intel.com/",
          w3cid: 57705
        }],
        github: "https://github.com/diekus/fold-angle/",
        wg: "Devices and Sensors Working Group",
        wgURI: "https://www.w3.org/das/",
        wgPatentURI: "#",
        testSuiteURI: "#",
        implementationReportURI: "https://www.w3.org/wiki/DAS/Implementations",
        otherLinks: [{
          key: 'Quality Assurance Lead',
          data: [{
            value: '#',
            href: '#'
          }]
        }],
        xref: "web-platform"
      };
    </script>
  </head>
  <body data-cite="FEATURE-POLICY PERMISSIONS CSSOM-VIEW">
    <section id='abstract'>
      <p>
        This document specifies an API that allows web applications to request the
        angular value to which a device with a screen hinge is folded. Under the
        right conditions, and if allowed, the value representing the angle in
        degrees is returned.
      </p>
    </section>
    <section id='sotd'>
      <p>
        Implementors need to be aware that this specification is extremely
        unstable. <strong>Implementors who are not taking part in the
        discussions will find the specification changing out from under them in
        incompatible ways.</strong> Vendors interested in implementing this
        specification before it eventually reaches the Candidate Recommendation
        phase should <a href=
        "#">subscribe to the
        repository on GitHub</a> and take part in the discussions.
      </p>
    </section>
    <section>
      <h2>
        Introduction
      </h2>
      <p>
        New types of mobile devices are appearing that have some sort of folding capabilities around the screen. Hence, when the device folds, it physically forms an angle. The main interest in knowing the fold angle is because there are opportunities in responsive design that enable new user experiences.
      </p>
      <p>
        From enhancing the usability of a website by avoiding the area of a fold, to enabling innovative use cases for the web, knowing the fold angle can help developers tailor their content to different devices. It can also enable to detect different postures the device might be in.
      </p>
      <p>
        Content can be consumed and browsed even when the device is not flat, in which case the developer might want to provide a different layout for it depending on the state of the angle of the fold. Additionally, developers can adapt content depending on various “postures” and potentially also animate some of these transitions. You can refer to a description of use cases.
      </p>
    </section>
    <section data-link-for="ScreenFoldPosture">
      <h2>
        Posture modes
      </h2>
      <p>
        This specification defines the following
        <dfn data-export="">posture</dfn> values:
      </p>
      <img src="images/modes.svg">
      <ol>
        <li>
          <a>Laptop</a> posture indicates that the device is being used as
          a traditional laptop, meaning one screen is placed on a more or
          less horizontal surface with a screen angle between 180 to 0 degrees.
        </li>
        <li>
          <a>Flat</a> posture indicates that one screen is being placed on
          a more or less horizontal surface with a screen angle around 180 degrees.
        </li>
        <li>
          <a>Tent</a> posture indicates that the edges of both screens are placed
          on a horizontal surface but with an angle > 180 degrees.
        </li>
        <li>
          <a>Tablet</a> posture...
        </li>
        <li>
          <a>Book</a> posture...
        </li>
      </ol>
      <p>
        In the API, the [=posture=] values are represented by the
        {{ScreenFoldPosture}} enum values.
      </p>
    </section>
    <section data-dfn-for="Screen">
      <h2>
        Extensions to the `Screen` interface
      </h2>
      <p>
        The [[cssom-view]] specification defines the {{Screen}} interface,
        which this specification extends:
      </p>
      <pre class="idl">
        [SecureContext]
        partial interface Screen {
          [SameObject] readonly attribute ScreenFold fold;
        };
      </pre>
    </section>
    <section data-dfn-for="ScreenFold">
      <h2>
        The <dfn>ScreenFold</dfn> interface
      </h2>
      <pre class="idl">
        [SecureContext, Exposed=(Window)]
        interface ScreenFold : EventTarget {
          readonly attribute unsigned short angle;
          readonly attribute ScreenFoldPosture posture;
          attribute EventHandler onchange;
        };

        enum ScreenFoldPosture {
          "laptop",
          "tent",
          "tablet",
          "book",
          "flat"
        };
      </pre>
      <section>
        <h3>The <dfn>angle</dfn> attribute: Get current screen fold angle</h3>
        <p>
          When getting the type attribute, the user agent MUST return the
          [=environment settings object/responsible document=]'s current screen fold angle.
        </p>
      </section>
      <section>
        <h3>The <dfn>posture</dfn> attribute: Get current screen fold posture</h3>
        <p>
          When getting the type attribute, the user agent MUST return the
          [=environment settings object/responsible document=]'s current screen fold {{posture}}.
        </p>
      </section>
      <section>
        <h3>The <dfn>onchange</dfn> attribute: Handle angle/posture changes</h3>
        <p data-link-for="ScreenFold">
          The {{onchange}} attribute is an <a data-cite="html">event handler</a> whose corresponding
          <a data-cite="html">event handler event type</a> is "<code>change</code>".
        </p>
      </section>
    </section>
    <section>
      <h3>
        Algorithms
      </h3>
      <section data-link-for='ScreenFold'>
        <h2>
          Screen fold angle change
        </h2>
        <p>
          Whenever the screen(s) fold angle changes, the <a>user agent</a> MUST run
          the following steps as part of the next <a>animation frame task</a>:
        </p>
        <ol class="algorithm">
          <li>Let |browsing contexts| be the <a>list of the descendant browsing contexts</a> of the <a>top-level browsing context</a>'s
          <a>document</a>.
          </li>
          <li>[=list/for each=] |context:browsing context| in |browsing contexts|, run
          the following sub-steps:
            <ol>
              <li>
                Let |document| be the |context|'s <a>active document</a>.
              </li>
              <li>
                If |document| is not visible per [[PAGE-VISIBILITY]],
                abort these steps.
              </li>
              <li>
                <a>Update the screen fold information</a> of |document|.
              </li>
              <li>
                <a>Fire an event</a> named `change` at |document|'s
                {{Screen.fold}} object.
              </li>
            </ol>
          </li>
        </ol>
        <p>
          Whenever a <a>document</a> becomes visible per [[PAGE-VISIBILITY]],
          in other words after the <a>now visible algorithm</a> is run, the
          <a>user agent</a> MUST run the following substeps as part of the next
          <a>animation frame task</a>:
        </p>
        <ol class="algorithm">
          <li>
            Let |document| be the <a>document</a> in question.
          </li>
          <li>
            Let |posture| and |angle| be respectively the |document|'s <a>
            current posture</a> and <a>current fold angle</a>.
          </li>
          <li>
            <a>Update the screen fold information</a> of the |document|.
          </li>
          <li>If |posture| is different from the |document|'s <a>current
          posture</a> or |angle| from the |document|'s <a>current
          fold angle</a>, run the following sub-steps:
            <ol>
              <li>
                <a>Fire an event</a> named `change` at the |document|'s
                {{Screen.fold}} object.
              </li>
            </ol>
          </li>
        </ol>
        <div class="note">
          <p>
            Developers need to be aware that a {{Screen.fold}} object
            from a <a>document</a> that is not visible, as per
            [[PAGE-VISIBILITY]], will not receive an orientation change event.
            This is to prevent unnecessary changes to layout, etc. in the
            non-visible web application.
          </p>
        </div>
        <div class='issue'>
          This section could be improved if the [[PAGE-VISIBILITY]]
          specification had a hook for when the document becomes visible and
          hidden. <a href=
          'https://github.com/w3c/page-visibility/pull/54'>PR 54</a>.
        </div>
      </section>
    </section>

    <section id="examples" class="informative">
      <h2>
        Examples
      </h2>
      <pre class="example js" title="Acquires and releases a screen wake lock">
        function tryKeepScreenAlive(minutes) {
          navigator.wakeLock.request("screen").then(lock =&gt; {
            setTimeout(() =&gt; lock.release(), minutes * 60 * 1000);
          });
        }

        tryKeepScreenAlive(10);
      </pre>
      <p>
        This example allows the user to request a screen wake lock by clicking
        on a checkbox, but updates the checkbox checked state in case the wake
        lock state changes:
      </p>
      <pre class="example js" id="onrelease-example">
        const checkbox = document.createElement("input");
        checkbox.setAttribute("type", "checkbox");
        document.body.appendChild(checkbox);

        const sentinel = await navigator.wakeLock.request("screen");
        checkbox.checked = true;
        sentinel.onrelease = () =&gt; checkbox.checked = false;
      </pre>
      <p>
        In this example, two different wake lock requests are created and
        released independently:
      </p>
      <pre class="example js">
        let lock1 = await navigator.wakeLock.request("screen");
        let lock2 = await navigator.wakeLock.request("screen");

        lock1.release();
        lock2.release();
      </pre>
    </section>
    <section>
      <h2>
        Dependencies
      </h2>
      <p>
        The following concepts and interfaces are defined in [[HTML]]:
        <dfn data-cite=
        "HTML/browsers.html#list-of-the-descendant-browsing-contexts">list of
        the descendant browsing contexts</dfn>.
      </p>
      <p>
        The following is defined in [[PAGE-VISIBILITY]]: <dfn data-cite=
        "PAGE-VISIBILITY#dfn-now-visible-algorithm">now visible
        algorithm</dfn>.
      </p>
      <p>
        The following is used but not defined in [[FULLSCREEN]]: <dfn><a href=
        'https://github.com/whatwg/fullscreen/issues/16'>animation frame
        task</a></dfn>.
      </p>
      <div class='issue'>
        This should now be updated since the <a>animation frame task</a> issue
        is recently resolved and the timing is now defined.
      </div>
    </section>
    <section id="conformance">
      <p>
        This specification defines conformance criteria for a single product: a
        <dfn>user agent</dfn> that implements the interfaces that it contains.
      </p>
    </section>
    <section id="idl-index" class="appendix"></section>
    <section class="appendix informative" id="acknowledgments">
      <h2>
        Acknowledgments
      </h2>
      <p>
        We would like to offer our sincere thanks to Daniel Appelquist, Alexis Menard,
        Jo Balletti, Ably Realtime and Michael Blix for their contributions
        to this work.
      </p>
    </section>
  </body>
</html>
